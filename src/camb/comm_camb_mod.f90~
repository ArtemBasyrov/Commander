module comm_camb_mod
  use healpix_types
  implicit none

  integer(i4b), parameter :: CAMB_NPAR      = 7
  integer(i4b), parameter :: CAMB_H         = 1
  integer(i4b), parameter :: CAMB_TAU       = 2
  integer(i4b), parameter :: CAMB_OMEGA_B   = 3
  integer(i4b), parameter :: CAMB_OMEGA_C   = 4
  integer(i4b), parameter :: CAMB_AS        = 5
  integer(i4b), parameter :: CAMB_NS        = 6
  integer(i4b), parameter :: CAMB_R         = 7

  integer(i4b), parameter :: CAMB_NSPEC     = 6
  integer(i4b), parameter :: CAMB_TT        = 1
  integer(i4b), parameter :: CAMB_TE        = 2
  integer(i4b), parameter :: CAMB_TB        = 3
  integer(i4b), parameter :: CAMB_EE        = 4
  integer(i4b), parameter :: CAMB_EB        = 5
  integer(i4b), parameter :: CAMB_BB        = 6
  
  type :: camb
     logical(lgt) :: do_lensing
     integer(i4b) :: lmax
     real(dp), dimension(CAMB_NPAR) :: theta
   contains
     procedure    :: getCls
  end type camb

contains

  !**************************************************
  !             Constructor routine
  !**************************************************
  function constructor(lmax, do_lensing)
    implicit none
    integer(i4b),         intent(in) :: lmax
    logical(lgt),         intent(in) :: do_lensing
    class(camb), pointer             :: constructor

    ! General parameters
    allocate(constructor)
    constructor%do_lensing          = do_lensing
    constructor%lmax                = lmax

    ! Initialize cosmological parameters to Planck 2015
    constructor%theta(CAMB_H)       = 0.d0
    constructor%theta(CAMB_TAU)     = 0.d0
    constructor%theta(CAMB_OMEGA_B) = 0.d0
    constructor%theta(CAMB_OMEGA_C) = 0.d0
    constructor%theta(CAMB_AS)      = 
    constructor%theta(CAMB_NS)      = 
    constructor%theta(CAMB_R)       = 
    
  end function constructor

  !**************************************************
  !             Main CAMB interface
  !**************************************************
  subroutine getCls(self, cls)
    implicit none
    class(camb),                                      intent(in)  :: self
    real(dp),      dimension(0:self%lmax,CAMB_NSPEC), intent(out) :: cls

    ! Return power spectrum
    cls = 0.d0
  end subroutine getCls
  
end module comm_camb_mod
